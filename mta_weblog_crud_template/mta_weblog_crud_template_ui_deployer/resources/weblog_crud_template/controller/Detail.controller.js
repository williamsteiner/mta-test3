sap.ui.define(["com/owi/webmin/weblog_crud_template/controller/BaseController","sap/ui/model/json/JSONModel","com/owi/webmin/weblog_crud_template/model/formatter","sap/m/MessageBox","sap/m/MessageToast"],function(e,t,o,i,n){"use strict";return e.extend("com.owi.webmin.weblog_crud_template.controller.Detail",{formatter:o,onInit:function(){var e=new t({busy:false,delay:0});this.getRouter().getRoute("object").attachPatternMatched(this._onObjectMatched,this);this.setModel(e,"detailView");this.getOwnerComponent().getModel().metadataLoaded().then(this._onMetadataLoaded.bind(this));this._oODataModel=this.getOwnerComponent().getModel();this._oResourceBundle=this.getResourceBundle()},onShareEmailPress:function(){var e=this.getModel("detailView");sap.m.URLHelper.triggerEmail(null,e.getProperty("/shareSendEmailSubject"),e.getProperty("/shareSendEmailMessage"))},onShareInJamPress:function(){var e=this.getModel("detailView"),t=sap.ui.getCore().createComponent({name:"sap.collaboration.components.fiori.sharing.dialog",settings:{object:{id:location.href,share:e.getProperty("/shareOnJamTitle")}}});t.open()},onDelete:function(){var e=this;var t=this.getModel("detailView"),o=t.getProperty("/sObjectPath"),i=this._oODataModel.getProperty(o+"/KEYTYPE"),s=this._oResourceBundle.getText("deleteText",i),a=this._oResourceBundle.getText("deleteSuccess",i);var r=function(){n.show(a);t.setProperty("/busy",false);var i=e.getOwnerComponent().oListSelector.findNextItem(o);e.getModel("appView").setProperty("/itemToSelect",i.getBindingContext().getPath())};this._confirmDeletionByUser({question:s},[o],r)},onEdit:function(){this.getModel("appView").setProperty("/addEnabled",false);var e=this.getView().getElementBinding().getPath();this.getRouter().getTargets().display("create",{mode:"update",objectPath:e})},_onObjectMatched:function(e){var t=e.getParameter("arguments");for(var o in t){t[o]=decodeURIComponent(t[o])}this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("weblog",t);this._bindView("/"+e)}.bind(this))},_bindView:function(e){var t=this.getModel("detailView");t.setProperty("/busy",false);this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){t.setProperty("/busy",true)},dataReceived:function(){t.setProperty("/busy",false)}}})},_onBindingChange:function(){var e=this.getView(),t=e.getElementBinding(),o=this.getModel("detailView"),i=this.getModel("appView");if(!t.getBoundContext()){this.getRouter().getTargets().display("detailObjectNotFound");this.getOwnerComponent().oListSelector.clearMasterListSelection();return}var n=t.getBoundContext().getPath(),s=this.getResourceBundle(),a=e.getModel().getObject(n),r=a.ROWID,l=a.KEYTYPE;o.setProperty("/sObjectId",r);o.setProperty("/sObjectPath",n);i.setProperty("/itemToSelect",n);this.getOwnerComponent().oListSelector.selectAListItem(n);o.setProperty("/saveAsTileTitle",s.getText("shareSaveTileAppTitle",[l]));o.setProperty("/shareOnJamTitle",l);o.setProperty("/shareSendEmailSubject",s.getText("shareSendEmailObjectSubject",[r]));o.setProperty("/shareSendEmailMessage",s.getText("shareSendEmailObjectMessage",[l,r,location.href]))},_onMetadataLoaded:function(){var e=this.getView().getBusyIndicatorDelay(),t=this.getModel("detailView");t.setProperty("/delay",0);t.setProperty("/busy",true);t.setProperty("/delay",e)},_confirmDeletionByUser:function(e,t,o,n,s){var a=function(){this._callDelete(t,o)}.bind(this);i.show(e.question,{icon:e.icon||i.Icon.WARNING,title:e.title||this._oResourceBundle.getText("delete"),actions:[i.Action.OK,i.Action.CANCEL],onClose:function(e){if(e===i.Action.OK){a()}else if(n){n()}}})},_callDelete:function(e,t){var o=this.getModel("detailView");o.setProperty("/busy",true);var i=function(){this._oODataModel.setUseBatch(true)}.bind(this);var n=function(){if(t){t();this._oODataModel.setUseBatch(true)}o.setProperty("/busy",false)}.bind(this);return this._deleteOneEntity(e[0],n,i)},_deleteOneEntity:function(e,t,o){var i=new Promise(function(t,o){this._oODataModel.setUseBatch(false);this._oODataModel.remove(e,{success:t,error:o,async:true})}.bind(this));i.then(t,o);return i}})});